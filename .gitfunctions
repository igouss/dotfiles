#!/bin/bash

#Log with visual tree
function log {
    git log --topo-order --decorate --graph --oneline --all
}

# flat log
function logf {
  git log --topo-order --decorate --first-parent --oneline --all
}

# Display Current branch
function current_branch { 
    ref=$(git symbolic-ref HEAD 2> /dev/null)
    echo ${ref#refs/heads/} 
}

function rollsoft {
    log
    read -e -p "Enter rev: " rev
    git reset --soft ${rev}
}
 
function rollhard {
    log
    read -e -p "Enter rev: " rev
    git reset --hard ${rev}
}

# marge current branch to another
function merge_to { 
    branch=`eval current_branch`
    git checkout "${@}" && git merge ${branch}
}

# execute git command with REMOTEREPO BRANCH substituted in arg0
function gitExecute {
    select REMOTEREPO in `git remote`; do echo $opt; break; done
    select BRANCH in `git branch | cut -c3- | paste -s -`; do break; done
    eval ${1}
    unset REMOTEREPO BRANCH
}

function pull {
    gitExecute 'git pull -v --stat --rebase ${REMOTEREPO} ${BRANCH}'
}

function push {
    gitExecute 'git push -v ${REMOTEREPO} ${BRANCH}'
}

function delrem {
    gitExecute 'git push ${REMOTEREPO} :heads/${BRANCH}'
}

function delloc {
    select BRANCH in `git branch | cut -c3- | paste -s -`; do break; done
    git branch -D ${BRANCH}
    unset BRANCH
}

# create an empty branch see http://gitcasts.com/posts/empty-branches                                                   
function git_empty_branch
{
    git-symbolic-ref HEAD refs/heads/$1
    rm .git/index
    git clean -fdx
    git commit --allow-empty -m "initial branch commit"
}

function merge
{
    gitExecute 'git pull ${REMOTEREPO} ${BRANCH} && git merge --no-ff ${BRANCH}'
}

